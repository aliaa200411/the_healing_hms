<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="report_hospital_billing">
        <t t-call="web.external_layout">
            <t t-set="doc" t-value="docs[0]"/>

            <!-- محتوى الفاتورة -->
            <main class="page" style="font-family:Arial, sans-serif; color:#2c3e50; min-height:100vh; display:flex; flex-direction:column;">

               <header style="display:flex; justify-content:center; align-items:center; margin-bottom:30px; gap:40px;">
                    <!-- الشعار -->
                    <div>
                        <img t-att-src="'/the_healing_hms/static/src/img/logo.png'" style="max-height:80px;"/>
                    </div>
                    <!-- بيانات الفاتورة -->
                    <div style="text-align:center;">
                        <h1 style="margin:0; font-size:28px; color:#34495e;">Hospital Invoice</h1>
                        <div style="font-size:14px; color:#7f8c8d;">
                            <div>Invoice #: <strong t-esc="doc.name"/></div>
                            <div>Date: <strong t-esc="doc.date"/></div>
                        </div>
                    </div>
                </header>

                <!-- معلومات المريض والطبيب - منقولة لأعلى -->
                <div style="margin-bottom:30px; background-color:#f8f9fa; padding:15px; border-radius:8px;">
                    <table style="width:100%; border-collapse:collapse; font-size:14px;">
                        <tr>
                            <th style="text-align:left; width:120px; padding:5px;">Patient:</th>
                            <td style="padding:5px; font-weight:bold;" t-esc="doc.patient_id.name"/>
                            <th style="text-align:left; width:120px; padding:5px;">Doctor:</th>
                            <td style="padding:5px; font-weight:bold;" t-esc="doc.doctor_id.user_id.name or '-'"/>
                        </tr>
                        <tr>
                            <th style="text-align:left; padding:5px;">Payment Method:</th>
                            <td style="padding:5px;" t-esc="doc.payment_method or '-'"/>
                            <th style="text-align:left; padding:5px;">Notes:</th>
                            <td style="padding:5px;" t-esc="doc.notes or '-'"/>
                        </tr>
                    </table>
                </div>

                <!-- المحتوى الرئيسي - يملأ المساحة المتبقية -->
                <div style="flex-grow:1;">
                    <!-- خطوط الفاتورة -->
                    <table style="width:100%; border-collapse:collapse; font-size:14px; margin-bottom:20px;">
                        <thead style="background-color:#ecf0f1; font-weight:bold;">
                            <tr>
                                <th style="border:1px solid #bdc3c7; padding:8px;">Product / Service</th>
                                <th style="border:1px solid #bdc3c7; padding:8px;">Description</th>
                                <th style="border:1px solid #bdc3c7; padding:8px; text-align:right;">Qty</th>
                                <th style="border:1px solid #bdc3c7; padding:8px; text-align:right;">Unit Price</th>
                                <th style="border:1px solid #bdc3c7; padding:8px;">Taxes</th>
                                <th style="border:1px solid #bdc3c7; padding:8px; text-align:right;">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="doc.line_ids" t-as="line">
                                <td style="border:1px solid #bdc3c7; padding:6px;" t-esc="line.product_id.name or ''"/>
                                <td style="border:1px solid #bdc3c7; padding:6px;" t-esc="line.name"/>
                                <td style="border:1px solid #bdc3c7; padding:6px; text-align:right;" t-esc="line.quantity"/>
                                <td style="border:1px solid #bdc3c7; padding:6px; text-align:right;" t-esc="line.price_unit"/>
                                <td style="border:1px solid #bdc3c7; padding:6px;">
                                    <span t-foreach="line.tax_ids" t-as="tax" t-esc="tax.name + ' '"/>
                                </td>
                                <td style="border:1px solid #bdc3c7; padding:6px; text-align:right;" t-esc="line.price_unit * line.quantity"/>
                            </tr>
                        </tbody>
                    </table>

                    <!-- المجموعات -->
                    <div style="display:flex; justify-content:flex-end; margin-bottom:30px;">
                        <table style="border-collapse:collapse; font-size:14px; width:300px;">
                            <tr>
                                <th style="border:1px solid #bdc3c7; padding:6px; background:#ecf0f1;">Untaxed Amount</th>
                                <td style="border:1px solid #bdc3c7; padding:6px; text-align:right;" t-esc="doc.amount_untaxed"/>
                            </tr>
                            <tr>
                                <th style="border:1px solid #bdc3c7; padding:6px; background:#ecf0f1;">Tax</th>
                                <td style="border:1px solid #bdc3c7; padding:6px; text-align:right;" t-esc="doc.amount_tax"/>
                            </tr>
                            <tr>
                                <th style="border:1px solid #bdc3c7; padding:6px; background:#f1c40f; color:#fff;">Total</th>
                                <td style="border:1px solid #bdc3c7; padding:6px; text-align:right; font-weight:bold; color:#e74c3c;" t-esc="doc.amount_total"/>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- Footer Note - منقول لأسفل الصفحة -->
                <footer style="margin-top:auto; padding-top:20px; border-top:1px solid #ecf0f1;">
                    <div style="font-size:12px; color:#7f8c8d; text-align:center;">
                        <p style="margin:0;">Thank you for choosing our hospital. If you have any questions regarding this invoice, please contact our billing department.</p>
                    </div>
                </footer>

            </main>
        </t>
    </template>

    <record id="hospital_billing_report_action" model="ir.actions.report">
        <field name="name">Patient Bill</field>
        <field name="model">hospital.billing</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">the_healing_hms.report_hospital_billing</field>
        <field name="report_file">the_healing_hms.report_hospital_billing</field>
        <field name="print_report_name">'Invoice-%s' % (object.name)</field>
    </record>
</odoo>